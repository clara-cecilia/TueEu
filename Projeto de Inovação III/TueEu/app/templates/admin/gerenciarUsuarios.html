<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gerenciar Usuários - Administrador</title>
  <!-- Bootstrap básico -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Arquivo CSS externo -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styleAdm.css') }}">
</head>
<body>
  <!-- Barra lateral -->
<nav>
  <h1>Administrador</h1>
  <ul>
    <li><a href="{{ url_for('admin.gerenciar_usuarios') }}">Gerenciar Usuários</a></li>
    <li><a href="{{ url_for('admin.gerenciar_servicos') }}">Gerenciar Serviços</a></li>
    <li><a href="{{ url_for('admin.gerenciar_adms') }}">Gerenciar Administradores</a></li>
    <li><a href="{{ url_for('auth.logout') }}">Sair</a></li>
  </ul>
</nav>

  <!-- Conteúdo Principal -->
      <main class="col-md-10 ms-sm-auto px-4">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
          <h2>Gerenciar Usuários</h2>
        </div>
        
        <!-- Tabela de Usuários -->
        <div class="table-responsive">
          <table class="table table-striped table-hover align-middle">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Email</th>
                <th>CPF</th>
                <th>Data de Nasc.</th>
                <th>Status</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody>
              {% for usuario in usuarios %}
              <tr>
                <td>{{ usuario.id }}</td>
                <td>{{ usuario.nome }}</td>
                <td>{{ usuario.email }}</td>
                <td>{{ usuario.cpf or '--' }}</td>
                <td>{{ usuario.data_nasc }}</td>
                <td>{{ usuario.status }}</td>
                <td>
                  <!-- Botão Editar: abre modal -->
                  <button type="button" class="btn btn-primary btn-sm edit-btn"
                          data-bs-toggle="modal"
                          data-bs-target="#editModal"
                          data-id="{{ usuario.id }}"
                          data-nome="{{ usuario.nome }}"
                          data-email="{{ usuario.email }}"
                          data-cpf="{{ usuario.cpf }}"
                          data-data_nasc="{{ usuario.data_nasc }}"
                          data-telefone="{{ usuario.telefone }}"
                          data-pais="{{ usuario.pais }}"
                          data-estado="{{ usuario.estado }}"
                          data-cidade="{{ usuario.cidade }}"
                          data-cep="{{ usuario.cep }}">
                    Editar
                  </button>
                  <!-- Botão Desativar: envia formulário para desativação -->
                  <form action="{{ url_for('admin.excluir_usuario', id=usuario.id) }}" method="post" class="d-inline" onsubmit="return confirm('Tem certeza que deseja desativar este usuário?');">
                    <button type="submit" class="btn btn-danger btn-sm">Desativar</button>
                  </form>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        
        <!-- Modal de Edição do Usuário -->
        <div class="modal fade" id="editModal" data-bs-backdrop="true" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">

          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <!-- O formulário terá seu action atualizado dinamicamente -->
              <form id="editUserForm" method="post">
                <div class="modal-header">
                  <h5 class="modal-title" id="editModalLabel">Editar Usuário</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>

                </div>
                <div class="modal-body">
                  <!-- Exemplo de campos a serem editados -->
                  <div class="mb-3">
                    <label for="userNome" class="form-label">Nome</label>
                    <input type="text" class="form-control" id="userNome" name="nome" required>
                  </div>
                  <div class="mb-3">
                    <label for="userEmail" class="form-label">Email</label>
                    <input type="email" class="form-control" id="userEmail" name="email" required>
                  </div>
                  <div class="mb-3">
                    <label for="userCPF" class="form-label">CPF</label>
                    <input type="text" class="form-control" id="userCPF" name="cpf">
                  </div>
                  <div class="mb-3">
                    <label for="userDataNasc" class="form-label">Data de Nascimento</label>
                    <input type="date" class="form-control" id="userDataNasc" name="data_nasc" required>
                  </div>
                  <div class="mb-3">
                    <label for="userTelefone" class="form-label">Telefone</label>
                    <input type="text" class="form-control" id="userTelefone" name="telefone">
                  </div>
                  <div class="mb-3">
                    <label for="userPais" class="form-label">País</label>
                    <input type="text" class="form-control" id="userPais" name="pais" required>
                  </div>
                  <div class="mb-3">
                    <label for="userEstado" class="form-label">Estado</label>
                    <input type="text" class="form-control" id="userEstado" name="estado" required>
                  </div>
                  <div class="mb-3">
                    <label for="userCidade" class="form-label">Cidade</label>
                    <input type="text" class="form-control" id="userCidade" name="cidade" required>
                  </div>
                  <div class="mb-3">
                    <label for="userCEP" class="form-label">CEP</label>
                    <input type="text" class="form-control" id="userCEP" name="cep">
                  </div>
                  <!-- Campo nova senha (opcional) -->
                  <div class="mb-3">
                    <label for="userSenha" class="form-label">Nova Senha (opcional)</label>
                    <input type="password" class="form-control" id="userSenha" name="senha">
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>

                  <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      
      </main>
    </div>
  </div>
  
  <!-- Bootstrap 5 JS Bundle com Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Script para preencher o modal com os dados do usuário -->
  <script>
    const editModal = document.getElementById('editModal');
    editModal.addEventListener('show.bs.modal', function (event) {
      // Botão que acionou o modal
      const button = event.relatedTarget;
      // Extrai os dados dos atributos data-*
      const id         = button.getAttribute('data-id');
      const nome       = button.getAttribute('data-nome');
      const email      = button.getAttribute('data-email');
      const cpf        = button.getAttribute('data-cpf');
      const dataNasc   = button.getAttribute('data-data_nasc');
      const telefone   = button.getAttribute('data-telefone');
      const pais       = button.getAttribute('data-pais');
      const estado     = button.getAttribute('data-estado');
      const cidade     = button.getAttribute('data-cidade');
      const cep        = button.getAttribute('data-cep');
      
      // Preenche os campos do modal
      editModal.querySelector('.modal-title').textContent = 'Editar Usuário ID ' + id;
      editModal.querySelector('#userNome').value      = nome;
      editModal.querySelector('#userEmail').value     = email;
      editModal.querySelector('#userCPF').value       = cpf;
      editModal.querySelector('#userDataNasc').value    = dataNasc;
      editModal.querySelector('#userTelefone').value    = telefone;
      editModal.querySelector('#userPais').value        = pais;
      editModal.querySelector('#userEstado').value      = estado;
      editModal.querySelector('#userCidade').value      = cidade;
      editModal.querySelector('#userCEP').value         = cep;
      // Limpa o campo de senha
      editModal.querySelector('#userSenha').value       = '';
      
      // Atualiza a action do formulário para a rota de edição
      let form = document.getElementById('editUserForm');
      // Gere a url base com um id dummy (ex: 0) e substitua
      let baseUrl = "{{ url_for('admin.editar_usuario', id=0) }}"; // ex: /editar_usuario/0
      form.action = baseUrl.slice(0, -1) + id;
    });
  </script>
</body>
</html>
